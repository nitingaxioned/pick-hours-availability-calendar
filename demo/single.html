<!DOCTYPE html>
<html>

<head>
  <title>Demo | Mark Your Calendar</title>
  <link rel="stylesheet" type="text/css" href="../css/mark-your-calendar.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"> -->
</head>

<body>
  <div id="picker"></div>
  <div>
    <p>Selected date: <span id="selected-date"></span></p>
    <p>Selected time: <span id="selected-time"></span></p>
    <p>Selected ID: <span id="the-id"></span></p>
  </div>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> -->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="../js/mark-your-calendar.js"></script>
  <script type="text/javascript">
    (function ($) {
      let pickrIndex = 0;
      reset();

      function reset() {
        $.getJSON("../available-slots-" + pickrIndex + ".json", function (jsonData) {
          let firstSlot = jsonData[0].start,
            initSlot = [[], [], [], [], [], [], []],
            dayIndex = 0,
            startDate = new Date(firstSlot);

          jsonData.forEach((val, index) => {
            if (dayIndex < 7) {
              initSlot[dayIndex].push(val);
              if (jsonData[index + 1] && (new Date(jsonData[index + 1].start)).getDate() != (new Date(val.start)).getDate()) {
                neoDate = new Date(jsonData[index + 1].start).setHours(0,0,0,0);
                curDete = new Date(val.start).setHours(0,0,0,0);
                let diff = neoDate - curDete;
                diffDay = diff / (1000 * 3600 * 24);
                dayIndex += diffDay;
              }
            }
          });

          $('#picker').markyourcalendar({
            availability: initSlot,
            startDate: startDate,
            onClick: function (ev, data) {
              // data is a list of datetimes
              var d = data[0].split(' ')[0];
              var t = data[0].split(' ')[1];
              var i = data[0].split(' ')[2];
              $('#selected-date').html(d);
              $('#selected-time').html(t);
              $('#the-id').html(i);
            },

            onClickNavigator: function (ev, instance) {
              pickrIndex++;
              reset();
            }
          });
        }).fail(function () {
          console.log("An error has occurred.");
        }).then(() => console.log("end"));
      }
    })(jQuery);
  </script>
</body>

</html>